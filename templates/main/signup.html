<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Master Trainer Signup</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root {
      --deep: #072443;
      --deep2: #0f3a63;
      --accent: #fff;
    }
    body { font-family: "Helvetica Neue", Arial, sans-serif; margin:0; padding:0; background:#f5f5f5; color:#06263a; }
    .btn { background: #fff; color: #07263f; padding: 6px 10px; border-radius: 4px; font-weight: 600; cursor: pointer; text-decoration: none; display:inline-block; }
    .content-container{display:flex;justify-content:center;align-items:center;min-height:60vh;padding:30px 12px;}
    .panel{background:linear-gradient(#2d6aa0,#214b6f);padding:26px;border-radius:8px;color:white;width:100%;max-width:540px;box-shadow:0 12px 30px rgba(5,20,40,0.06);}
    .panel-inner{background:linear-gradient(#eaf1fb,#d6e7fb);color:#111;padding:22px;border-radius:8px;}
    .title{font-size:28px;color:#2b6fb2;margin-bottom:14px;text-align:center;}
    .form-table{width:100%;border-collapse:collapse;margin-top:6px;}
    .label-cell{font-weight:700;width:38%;padding:12px;text-align:right;vertical-align:middle;color:#083355;}
    .input-cell{padding:12px;}
    input[type="text"], input[type="password"], input[type="tel"]{width:96%;padding:8px;border:1px solid #c9d6e8;border-radius:4px;background:white;}
    .primary-btn{background:linear-gradient(#4aa1e8,#2a6fb0);color:#fff;border:none;padding:12px;border-radius:6px;width:100%;margin-top:18px;font-weight:700;cursor:pointer;}
    .field-error{color:#b00020;font-size:13px;margin-top:6px;display:block;}
    .captcha-row { display:flex; align-items:center; gap:10px; }
    .captcha-question { font-weight:700; background:#fff; padding:6px 10px; border-radius:4px; color:#0b3550; }
    .refresh-btn { background:#eee; border:1px solid #ccc; padding:6px 10px; border-radius:4px; cursor:pointer; }
    .messages { list-style:none; padding:0; margin:0 0 12px 0; }
    .messages li { padding:8px 10px; border-radius:6px; margin-bottom:8px; font-weight:700; }
    .messages .error { background:#fdecea; color:#8a1b1b; }
    .messages .success { background:#e6f6ea; color:#1b6b2a; }
    a.small-link { display:block; text-align:center; margin-top:12px; color:#083355; text-decoration:underline; }
    @media (max-width:520px){ .label-cell{display:block;text-align:left;width:100%;} .input-cell{display:block;} input{width:100%;} .panel{padding:18px;} }
  </style>
</head>
<body>
  <div class="content-container" role="main">
    <div class="panel" role="region" aria-labelledby="signup-heading">
      <div class="panel-inner">
        <h2 id="signup-heading" class="title">Master Trainer Signup</h2>

        {% if messages %}
          <ul class="messages" aria-live="polite">
            {% for message in messages %}
              <li class="{{ message.tags }}">{{ message }}</li>
            {% endfor %}
          </ul>
        {% endif %}

        <form id="signupForm" method="post" novalidate>
          {% csrf_token %}
          <table class="form-table" role="presentation">
            <tr>
              <td class="label-cell"><label for="{{ form.mobile.id_for_label }}">Mobile</label></td>
              <td class="input-cell">
                {{ form.mobile }}
                <div id="mobile_feedback" class="field-error" style="display:none"></div>
              </td>
            </tr>

            <tr>
              <td class="label-cell"><label for="{{ form.password.id_for_label }}">Password</label></td>
              <td class="input-cell">{{ form.password }}</td>
            </tr>

            <!-- Simple captcha display -->
            <tr>
              <td class="label-cell">Captcha</td>
              <td class="input-cell">
                <div class="captcha-row" aria-live="polite">
                  <div class="captcha-question" id="captchaQuestion">{{ captcha_question }}</div>
                  <button type="button" id="refreshCaptcha" class="refresh-btn" aria-label="Refresh captcha">Refresh</button>
                </div>
                <div style="margin-top:8px;">
                  <input id="captchaInput" name="signup_captcha" type="text" placeholder="Enter captcha answer" autocomplete="off" style="padding:8px;border:1px solid #c9d6e8;border-radius:4px;width:46%;">
                  <span id="captchaErr" class="field-error" style="display:none"></span>
                </div>
              </td>
            </tr>
          </table>

          <button class="primary-btn" type="submit">Create account</button>
        </form>

        <a href="{% url 'login' %}" class="small-link">Back to login</a>
      </div>
    </div>
  </div>

<script>
(function(){
  const refreshBtn = document.getElementById('refreshCaptcha');
  const qEl = document.getElementById('captchaQuestion');
  const input = document.getElementById('captchaInput');
  const err = document.getElementById('captchaErr');
  const form = document.getElementById('signupForm');

  refreshBtn.addEventListener('click', function(){
    fetch("{% url 'signup_captcha' %}", { method:'GET', credentials:'same-origin', headers:{'Accept':'application/json'} })
      .then(r => r.json())
      .then(j => {
        if (j && j.question) {
          qEl.textContent = j.question;
          input.value = '';
          err.style.display = 'none';
        }
      });
  });

  form.addEventListener('submit', function(e){
    err.style.display='none';
    const val = (input.value||'').trim();
    if (!val) {
      e.preventDefault();
      err.style.display='block';
      err.textContent = 'Please enter captcha answer.';
      input.focus();
      return false;
    }
    if (!/^-?\d+$/.test(val)) {
      e.preventDefault();
      err.style.display='block';
      err.textContent = 'Captcha answer must be a number.';
      input.focus();
      return false;
    }
    return true;
  });
})();
</script>

{% if account_created %}
<script>
  alert("Account created successfully!");
  window.location.href = "{% url 'login' %}";
</script>
{% endif %}
</body>
</html>
